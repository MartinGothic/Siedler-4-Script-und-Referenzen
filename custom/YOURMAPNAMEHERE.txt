
------------------------------------------------------------
-- ZIEHE DIE DATEI IN BlueByte/Die Siedler IV/Script
-- BENENNE DIE DATEI WIE EINE DEINER SELBSTERSTELLEN MAPS UND SIE WIRD AUSGEFÃœHRT
--		   ----
-- PUT THIS FOLDER IN BlueByte/Settlers 4/Script
-- NAME IT LIKE ONE OF YOUR CUSTOM MAPS AND IT WILL GET EXECUTED
--		----------

-- BEISPIEL
-- EXAMPLE

-- MAP NAME: mymap.map
-- -> nenne diese Datei mymap.txt
-- -> name this file mymap.txt
-----------------------------------------------
function getTableContents(t,tname)
	if type(t) ~= "table" then return tname .. " = <NOT A TABLE>" end
	local ret = ""
	ret = tname .. " = {\n"
	local i = next(t, nil)
	--dumping (inefficient -> lazy)
	-- first dump numbers
	while i ~= nil do
		local str = tostring(i)
		local strtype = type(t[str])
		if strtype == "number" then 
			strtype = tostring(t[str]) 
			ret = ret .. "\t" .. str .. " = " .. strtype .. "\n"
		end
		i = next(t,i)
	end
	--reset
	 i = next(t, nil)
	-- secondly dump strings
	while i ~= nil do
		local str = tostring(i)
		local strtype = type(t[str])
		if strtype == "string" then 
			strtype = tostring(t[str]) 
			ret = ret .. "\t" .. str .. " = \"" .. strtype .. "\"\n"
		end
		i = next(t,i)
	end
	--reset
	 i = next(t, nil)
	-- secondly dump functions/table(notyet)/userdata/nil
	while i ~= nil do
		local str = tostring(i)
		local strtype = type(t[str])
		if strtype == "function" or strtype == "table" or strtype == "userdata"  or strtype == "nil" then 
			ret = ret .. "\t" .. str .. " = " .. strtype .. "\n"
		end
		i = next(t,i)
	end
	ret = ret .. "}\n"
	return ret
end
-- i dont know lua 3.2.1 so there apparently is no _G
function mainfunc()
	fhandle = openfile("LUA_S4_TABLES.txt","w")
	--local s = getn(Buildings)
	local buildingDumpStr = getTableContents(Buildings,"Buildings")
	local eventDS = getTableContents(Events,"Events")
	local AIDS = getTableContents(AI,"AI")
	local vehicleDS = getTableContents(Vehicles,"Vehicles")
	local gameDS = getTableContents(Game,"Game")
	local settlerDS = getTableContents(Settlers,"Settlers")
	local goodsDS = getTableContents(Goods,"Goods")
	local dbgDS = getTableContents(dbg,"dbg")
	local effectsDS= getTableContents(Effects,"Effects")
	local varsDS = getTableContents(Vars,"Vars")
	local magicDS = getTableContents(Magic,"Magic")
	local soundsDS = getTableContents(Sounds,"Sounds")
	
	
	write(fhandle,type(global) .. "\n")
	write(fhandle,buildingDumpStr)
	write(fhandle,eventDS)
	write(fhandle,AIDS)
	write(fhandle,vehicleDS)
	write(fhandle,gameDS)
	write(fhandle,settlerDS)
	write(fhandle,goodsDS)
	write(fhandle,dbgDS)
	write(fhandle,effectsDS)
	write(fhandle,varsDS)
	write(fhandle,magicDS)
	write(fhandle,soundsDS)
	closefile(fhandle)
end

function new_game()
	request_event(mainfunc,Events.FIRST_TICK_OF_NEW_OR_LOADED_GAME)
end


function register_functions()
	reg_func(mainfunc)
end
